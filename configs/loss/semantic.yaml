# Semantic Segmentation Loss Configuration
# Combines geometric loss (from MVS) with semantic segmentation loss

# Training Loss: geometric loss + semantic loss
# Geometric loss: same as overall_loss for MVS task
# Semantic loss: CrossEntropyLoss with label smoothing and class weights
train_criterion: "ConfAndExcludeTopNPercentPixelLoss(FactoredGeometryScaleRegr3DPlusNormalGMLoss(RobustRegressionLoss(alpha=0.5, scaling_c=0.05), norm_mode='avg_dis', depth_type_for_loss='depth_along_ray', loss_in_log=True, flatten_across_image_only=True, compute_pairwise_relative_pose_loss=False, compute_world_frame_points_loss=True, apply_normal_and_gm_loss_to_synthetic_data_only=True, cam_frame_points_loss_weight=0.1, depth_loss_weight=0.1, ray_directions_loss_weight=0.1, pose_quats_loss_weight=0.1, pose_trans_loss_weight=0.1, scale_loss_weight=0.1, world_frame_points_loss_weight=1, normal_loss_weight=0.3, gm_loss_weight=0.3), conf_alpha=0.2, top_n_percent=5, apply_to_real_data_only=True, conf_loss_set_indices=[0], exclude_loss_set_indices=[1, 2]) + 0.03 * NonAmbiguousMaskLoss(BCELoss()) + 0.10 * SemanticSegmentationLoss(ignore_index=0, label_key='instance', logit_key='semantic_logits', apply_valid_mask=True, apply_non_ambiguous_mask=True, apply_pred_semantic_valid_mask=False, ce_weight=1.0, dice_weight=0.0, label_smoothing=0.05)"


# Validation Loss
test_criterion: "ExcludeTopNPercentPixelLoss(FactoredGeometryScaleRegr3DPlusNormalGMLoss(RobustRegressionLoss(alpha=0.5, scaling_c=0.05), norm_mode='avg_dis', depth_type_for_loss='depth_along_ray', loss_in_log=True, flatten_across_image_only=True, compute_pairwise_relative_pose_loss=False, compute_world_frame_points_loss=True, apply_normal_and_gm_loss_to_synthetic_data_only=True, cam_frame_points_loss_weight=0.1, depth_loss_weight=0.1, ray_directions_loss_weight=0.1, pose_quats_loss_weight=0.1, pose_trans_loss_weight=0.1, scale_loss_weight=0.1, world_frame_points_loss_weight=1, normal_loss_weight=0.3, gm_loss_weight=0.3), top_n_percent=5, apply_to_real_data_only=True, loss_set_indices=[0, 1, 2]) + 0.03 * NonAmbiguousMaskLoss(BCELoss()) + 0.10 * SemanticSegmentationLoss(ignore_index=0, label_key='instance', logit_key='semantic_logits', apply_valid_mask=True, apply_non_ambiguous_mask=True, apply_pred_semantic_valid_mask=False, ce_weight=1.0, dice_weight=0.0, label_smoothing=0.0)"

# Loss weights
geometric_loss_weight: 1.0
semantic_loss_weight: 1.0
